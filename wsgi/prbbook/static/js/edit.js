// Generated by CoffeeScript 1.4.0
(function() {
  var plugin;

  plugin = function($) {
    return $.fn.toJSON = function() {
      var inputs, object;
      inputs = this.serializeArray();
      object = {};
      $(inputs).each(function(index) {
        if ((this.name != null) && (this.value != null)) {
          return object[this.name] = parseFloat(this.value.replace(",", "."));
        }
      });
      return JSON.stringify(object);
    };
  };

  plugin(jQuery);

  $(function() {
    return $('#preview').click(function(event) {
      var engine, first_img_url, form, object, second_img_url, stage_count;
      form = $('#edit_form');
      object = form.toJSON();
      engine = $("#edit_form").attr("engine");
      stage_count = $("#edit_form").attr("stages");
      first_img_url = "/problems/engines/" + engine + "/img/" + object + "/stage/1/";
      second_img_url = "/problems/engines/" + engine + "/img/" + object + "/stage/" + stage_count + "/";
      console.log(object, engine, stage_count, first_img_url, second_img_url);
      return $.getJSON('/problems/engines/preview/request', {
        engine: engine,
        in_params: object
      }, function(data, textStatus, jqXHR) {
        console.log("Data: ", data);
        console.log("textStatus: ", textStatus);
        console.log("jqXHR: ", jqXHR);
        if (textStatus === "success") {
          if (data.status === "success") {
            $("#first_image").attr({
              'src': first_img_url
            });
            $("#second_image").attr({
              'src': second_img_url
            });
            return $("#out_params").html(data.body);
          } else if (data.status === "error") {
            $("#error-text").html(data.body);
            return $('#error-modal').modal();
          }
        } else if (textStatus === "error") {
          return alert("Error 500. Запрос к серверу завершился с ошибкой.");
        }
      });
    });
  });

}).call(this);
